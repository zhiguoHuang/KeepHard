<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv=Content-Type content="text/html;charset=utf-8">
    <meta charset="gbk">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection"/>
    <meta content="yes" name="apple-touch-fullscreen"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no" />
    <title>报表钉钉免登录</title>

    <!--<script type="text/javascript" src="../js/finereport.js"></script>-->
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>

    <script th:inline="javascript">
        var _config = [[${config}]]
    </script>

    <!--<script type="text/javascript" src="../js/zepto.min.js"></script>-->
    <!--<script type="text/javascript" src="http://g.alicdn.com/dingding/open-develop/1.6.9/dingtalk.js"></script>-->

    <script src="https://g.alicdn.com/dingding/dingtalk-jsapi/2.10.3/dingtalk.open.js"></script>
    <script src="../js/test.js"></script>

</head>
<body>
<div align="center">
    <img id ="userImg" alt="头像" src="../image/default.png">
</div>
<div align="center">
    <span>UserName:</span>
    <div id="userName" style="display:inline-block"></div>
</div >
<div align="center">
    <span>UserId:</span>
    <div id="userId" style="display:inline-block"></div>
</div>

<div align="center">
    <input type="hidden" id="name">
    <input type="hidden" id="password">
    <input type="button" value="授权登录" onclick="login()">
</div>


<script src="../js/logger.js"></script>
<script>
    function login(){

        var name =document.getElementById("name").value;
        var password =document.getElementById("password").value;
       // alert(name+password)
        jQuery.ajax({
            url:"http://10.2.121.134:8075/WebReport/ReportServer?op=fs_load&cmd=sso",//单点登录的报表服务器
            dataType:"jsonp",
            data:{"fr_username":name,"fr_password":password},
            jsonp:"callback",
            timeout:5000,//超时时间（单位：毫秒）
            success:function(data) {
                if (data.status === "success") {
                    alert("success"); //登录成功

                    window.location=data.url;//登录成功，直接跳转到平台系统页面
                }
                else if (data.status === "fail"){
                    alert("fail");//登录失败（用户名或密码错误）
                }
            },
            error:function(){
                alert("error"); // 登录失败（超时或服务器其他错误）
            }
        });
    }
</script>
</body>
</html>